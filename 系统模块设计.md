# SquadFile 登录模块系统设计文档

## 1. 概述

### 1.1 目的
本文档旨在详细描述 SquadFile 网盘产品的登录模块系统设计，包括功能需求、技术架构、接口设计、安全策略等方面，为开发团队提供清晰的技术指导。

### 1.2 范围
本文档涵盖系统核心模块的设计，包括用户认证、会话管理、安全控制、系统设置、日志管理和统计报表等相关功能。

### 1.3 术语和缩写
- JWT: JSON Web Token
- API: Application Programming Interface
- UI: User Interface
- UX: User Experience

## 2. 功能需求

### 2.1 用户登录
- 支持"账号+密码"登录方式
- 密码错误3次后账号临时锁定10分钟（防暴力破解）
- 登录成功后生成认证令牌用于后续请求验证

### 2.2 登录后引导
- 新用户首次登录触发"新手引导"
- 管理员登录显示"待处理事项"（如存储容量预警、待分配权限请求）

### 2.3 账号管理（管理员专属）
- 账号创建：支持填写"账号名（唯一）、初始密码、所属部门（可选）"，提供"普通成员/部门负责人"角色模板，自动分配基础权限
- 账号维护：支持删除账号（删除前二次确认，关联文件自动转移至管理员指定目录）、重置密码（重置后为默认密码"123456a!"，用户首次登录需强制修改）
- 密码规则：新密码需满足"6位以上+字母+数字"复杂度，支持管理员设置"密码有效期（如90天）"，到期前提醒用户修改
- 语言设置：支持中文和英文两种显示语言，管理员可设置系统默认语言，用户可在登录页和首页通过下拉列表切换显示语言

### 2.4 系统日志
- 登录日志：记录所有用户的登录尝试，包括成功和失败的登录
- 下载日志：记录所有文件下载操作
- 日志查询：支持按条件筛选日志记录

### 2.5 统计报表
- 基础统计：显示系统关键指标概览
- 最新上传：显示最新上传的文件列表
- 文件类型分布：统计各种文件类型的分布情况
- 分享链接统计：统计分享链接相关数据
- 下载统计：统计文件下载次数

## 3. 系统架构设计

### 3.1 技术栈
- 后端：.NET 9.0（单一项目结构）
- 前端：Uniapp（基于Vue3）
- 数据库：SQLite（轻量化，≤20人团队）或 MySQL（≥20人团队）

### 3.2 架构图
```
┌─────────────────────────────────────────────────────────────┐
│                        客户端层 (Client Layer)                 │
├─────────────────────────────────────────────────────────────┤
│  Web端(Vue3)    │  移动端(Uniapp)    │  桌面端(Electron)    │
│  - Chrome/Edge  │  - Android/iOS     │  - Windows/macOS    │
│  - 响应式设计    │  - 原生体验        │  - 系统托盘         │
└─────────────────────────────────────────────────────────────┘
                            │ HTTPS/WSS
┌─────────────────────────────────────────────────────────────┐
│                      应用服务层 (Application Layer)             │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────┐  │
│  │                    SquadFile 应用程序                    │  │
│  │  - 控制器 (Controllers)                                │  │
│  │  - 服务 (Services)                                     │  │
│  │  - 数据模型 (Models)                                   │  │
│  │  - 数据上下文 (DbContext)                              │  │
│  │  - 认证授权 (JWT)                                      │  │
│  └─────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────┘
                            │
┌─────────────────────────────────────────────────────────────┐
│                      数据存储层 (Storage Layer)               │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────┐  ┌─────────────────┐  ┌───────────────┐ │
│  │ 关系型数据库     │  │ 配置存储         │  │ 文件存储       │ │
│  │ - SQLite/MySQL  │  │ - 文件/数据库    │  │ - 本地/云存储  │ │
│  └─────────────────┘  └─────────────────┘  └───────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

## 4. 核心模块设计

### 4.1 用户认证模块

#### 4.1.1 认证流程
1. 用户输入账号和密码
2. 前端对密码进行加密处理
3. 向后端发送认证请求
4. 后端验证账号密码
5. 验证通过后生成JWT令牌
6. 返回认证结果和令牌给前端
7. 前端存储令牌并用于后续请求

#### 4.1.2 安全策略
- 密码存储：使用SHA256加密算法存储密码
- 传输安全：使用HTTP传输（开发环境）
- 令牌安全：JWT令牌包含过期时间，支持刷新机制
- 防暴力破解：密码错误3次后账号临时锁定10分钟

### 4.2 令牌管理模块

#### 4.2.1 令牌生命周期
- 登录时生成访问令牌和刷新令牌
- 每次请求验证令牌有效性
- 令牌过期时使用刷新令牌获取新令牌
- 登出时令牌失效

#### 4.2.2 令牌管理
- 访问令牌：短期有效（如1小时）
- 刷新令牌：长期有效（如7天）
- 支持令牌撤销机制

### 4.3 账号管理模块

#### 4.3.1 账号创建
- 验证账号名唯一性
- 密码复杂度验证
- 自动分配基础权限

#### 4.3.2 账号维护
- 删除账号前二次确认
- 关联文件自动转移至管理员指定目录
- 密码重置后设置默认密码，用户首次登录需强制修改

#### 4.3.3 密码策略
- 新密码需满足"6位以上+字母+数字"复杂度
- 支持管理员设置密码有效期（如90天）
- 到期前提醒用户修改

### 4.4 系统日志模块

#### 4.4.1 日志类型
- 登录日志：记录用户登录尝试
- 下载日志：记录文件下载操作

#### 4.4.2 日志内容
- 登录日志包含：用户ID、用户名、登录时间、IP地址、用户代理、登录结果、失败原因
- 下载日志包含：用户ID、用户名、下载时间、文件ID、原始文件名、文件路径、文件大小、IP地址、设备类型、用户代理

#### 4.4.3 日志管理
- 支持按条件查询日志
- 支持分页显示日志
- 支持日志导出功能

### 4.5 统计报表模块

#### 4.5.1 统计内容
- 基础统计数据：总用户数、总文件数、总文件夹数、存储使用量、总下载数
- 最新上传文件：最新上传的10个文件列表
- 文件类型分布：各种文件类型的分布情况
- 分享链接统计：总链接数、活跃链接数
- 下载统计：文件下载次数统计

#### 4.5.2 数据展示
- 以卡片形式展示基础统计数据
- 以表格形式展示详细统计数据
- 以进度条形式展示文件类型分布

## 5. 数据库设计

### 5.1 用户表 (Users)
```sql
CREATE TABLE Users (
    Id              INT PRIMARY KEY AUTO_INCREMENT,
    Username        VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名，唯一',
    Email           VARCHAR(100) UNIQUE COMMENT '邮箱地址',
    PasswordHash    VARCHAR(255) NOT NULL COMMENT 'SHA256加密密码',
    DisplayName     VARCHAR(100) COMMENT '显示名称',
    Avatar          VARCHAR(500) COMMENT '头像URL',
    Department      VARCHAR(100) COMMENT '所属部门',
    Role            ENUM('Admin', 'DepartmentManager', 'Member') DEFAULT 'Member',
    Status          ENUM('Active', 'Inactive', 'Locked') DEFAULT 'Active',
    IsFirstLogin    BOOLEAN DEFAULT TRUE COMMENT '是否首次登录',
    PasswordExpiry  DATETIME COMMENT '密码过期时间',
    LastLoginTime   DATETIME COMMENT '最后登录时间',
    LastLoginIp     VARCHAR(45) COMMENT '最后登录IP',
    LoginFailCount  INT DEFAULT 0 COMMENT '登录失败次数',
    LockTime        DATETIME COMMENT '锁定时间',
    CreatedBy       INT COMMENT '创建者ID',
    CreatedTime     DATETIME DEFAULT CURRENT_TIMESTAMP,
    UpdatedTime     DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    DeletedTime     DATETIME COMMENT '软删除时间',
    PreferredLanguage VARCHAR(10) DEFAULT NULL COMMENT '语言偏好'
);
```

### 5.2 系统设置表 (SystemSettings)
```sql
CREATE TABLE SystemSettings (
    Id              INT PRIMARY KEY AUTO_INCREMENT,
    DefaultLanguage VARCHAR(10) DEFAULT 'zh-Hans' COMMENT '默认语言',
    SiteName        VARCHAR(100) COMMENT '站点名称',
    LoginLogoPath   VARCHAR(500) COMMENT '登录页LOGO路径',
    HomeLogoPath    VARCHAR(500) COMMENT '首页LOGO路径',
    MaxFileSize     INT DEFAULT 100 COMMENT '最大文件大小(MB)',
    StorageLimit    INT DEFAULT 10240 COMMENT '存储限制(MB)',
    FileStoragePath VARCHAR(500) DEFAULT 'uploads' COMMENT '文件存储路径',
    CreatedTime     DATETIME DEFAULT CURRENT_TIMESTAMP,
    UpdatedTime     DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

### 5.3 登录日志表 (LoginLog)
```sql
CREATE TABLE LoginLog (
    Id              INT PRIMARY KEY AUTO_INCREMENT,
    UserId          INT NOT NULL COMMENT '用户ID',
    Username        VARCHAR(50) NOT NULL COMMENT '用户名',
    LoginTime       DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '登录时间',
    IpAddress       VARCHAR(45) COMMENT 'IP地址',
    UserAgent       VARCHAR(500) COMMENT '用户代理',
    LoginResult     BOOLEAN NOT NULL COMMENT '登录结果',
    FailureReason   VARCHAR(255) COMMENT '失败原因'
);
```

### 5.4 下载日志表 (DownloadLog)
```sql
CREATE TABLE DownloadLog (
    Id              INT PRIMARY KEY AUTO_INCREMENT,
    UserId          INT NOT NULL COMMENT '用户ID',
    Username        VARCHAR(50) NOT NULL COMMENT '用户名',
    DownloadTime    DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '下载时间',
    FileId          INT NOT NULL COMMENT '文件ID',
    OriginalFileName VARCHAR(255) NOT NULL COMMENT '原始文件名',
    FilePath        VARCHAR(500) NOT NULL COMMENT '文件路径',
    FileSize        BIGINT NOT NULL COMMENT '文件大小(字节)',
    IpAddress       VARCHAR(45) COMMENT 'IP地址',
    DeviceType      VARCHAR(100) COMMENT '设备类型',
    UserAgent       VARCHAR(500) COMMENT '用户代理'
);
```

// 用户会话表已移除，因项目不需要用户会话管理

## 6. API 接口设计

### 6.1 登录接口
```http
POST /squadfile-api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "password123",
  "deviceInfo": {
    "deviceType": "web",
    "deviceName": "Chrome Browser",
    "userAgent": "Mozilla/5.0...",
    "ipAddress": "192.168.1.100"
  }
}
```

**响应：**
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "uuid-refresh-token",
    "expiresIn": 3600,
    "user": {
      "id": 1,
      "username": "admin",
      "displayName": "系统管理员",
      "email": "admin@example.com",
      "role": "Admin",
      "avatar": "/avatars/admin.jpg",
      "isFirstLogin": false
    }
  }
}
```

### 6.2 刷新令牌接口
```http
POST /squadfile-api/auth/refresh
Content-Type: application/json
Authorization: Bearer {refresh_token}

{
  "refreshToken": "uuid-refresh-token"
}
```

### 6.3 登出接口
```http
POST /squadfile-api/auth/logout
Authorization: Bearer {access_token}
```

### 6.4 修改密码接口
```http
PUT /squadfile-api/auth/password
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "oldPassword": "old_password",
  "newPassword": "new_password",
  "confirmPassword": "new_password"
}
```

### 6.5 创建用户接口（管理员）
```http
POST /squadfile-api/users
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "username": "newuser",
  "email": "newuser@example.com",
  "displayName": "新用户",
  "department": "研发部",
  "role": "Member",
  "storageQuota": 1073741824,
  "initialPassword": "123456a!"
}
```

### 6.6 重置用户密码接口（管理员）
```http
POST /squadfile-api/users/{userId}/reset-password
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "newPassword": "123456a!"
}
```

### 6.7 获取系统语言设置
```http
GET /squadfile-api/system/language-settings
Authorization: Bearer {access_token}

响应：
{
  "code": 200,
  "message": "成功",
  "data": {
    "defaultLanguage": "zh-Hans",
    "supportedLanguages": [
      {"code": "zh-Hans", "name": "中文"},
      {"code": "en-US", "name": "English"}
    ]
  }
}
```

### 6.8 更新系统默认语言设置
```http
PUT /squadfile-api/system/language-settings
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "defaultLanguage": "en-US"
}

响应：
{
  "code": 200,
  "message": "语言设置更新成功"
}
```

### 6.9 更新用户语言偏好
```http
PUT /squadfile-api/system/users/{userId}/language
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "preferredLanguage": "en-US"
}

响应：
{
  "code": 200,
  "message": "语言偏好更新成功"
}
```

### 6.10 获取管理统计数据
```http
GET /squadfile-api/system/admin-stats
Authorization: Bearer {access_token}

响应：
{
  "code": 200,
  "message": "成功",
  "data": {
    "totalUsers": 10,
    "totalFiles": 100,
    "totalFolders": 20,
    "storageUsed": 104857600,
    "storageUsedDisplay": "100 MB",
    "totalDownloads": 50,
    "latestFiles": [
      {
        "id": 1,
        "name": "example.pdf",
        "size": 1048576,
        "uploadTime": "2024-01-01T12:00:00Z",
        "uploadedByUserId": 1,
        "uploadedBy": "admin"
      }
    ],
    "fileTypeDistribution": [
      {
        "extension": ".pdf",
        "count": 20
      }
    ],
    "totalShareLinks": 15,
    "activeShareLinks": 10,
    "downloadStats": [
      {
        "fileId": 1,
        "fileName": "example.pdf",
        "downloadCount": 5
      }
    ]
  }
}
```

### 6.11 获取登录日志
```http
GET /squadfile-api/log/login?page=1&pageSize=20&searchQuery=admin
Authorization: Bearer {access_token}

响应：
{
  "code": 200,
  "message": "成功",
  "data": {
    "items": [
      {
        "id": 1,
        "userId": 1,
        "username": "admin",
        "loginTime": "2024-01-01T12:00:00Z",
        "ipAddress": "192.168.1.100",
        "userAgent": "Mozilla/5.0...",
        "loginResult": true,
        "failureReason": null
      }
    ],
    "totalCount": 1,
    "page": 1,
    "pageSize": 20,
    "totalPages": 1
  }
}
```

### 6.12 获取下载日志
```http
GET /squadfile-api/log/download?page=1&pageSize=20&searchQuery=example.pdf
Authorization: Bearer {access_token}

响应：
{
  "code": 200,
  "message": "成功",
  "data": {
    "items": [
      {
        "id": 1,
        "userId": 1,
        "username": "admin",
        "downloadTime": "2024-01-01T12:00:00Z",
        "fileId": 1,
        "originalFileName": "example.pdf",
        "filePath": "/uploads/example.pdf",
        "fileSize": 1048576,
        "ipAddress": "192.168.1.100",
        "deviceType": "Windows",
        "userAgent": "Mozilla/5.0..."
      }
    ],
    "totalCount": 1,
    "page": 1,
    "pageSize": 20,
    "totalPages": 1
  }
}
```

## 7. 前端设计

### 7.1 登录页面
- 用户名输入框
- 密码输入框（密码类型）
- 登录按钮
- 忘记密码链接（如需要）

### 7.2 用户引导
- 新用户首次登录显示引导流程
- 管理员登录显示待处理事项面板

### 7.3 响应式设计
- 适配网页端、移动端和平板端
- 在不同设备上提供一致的用户体验

### 7.4 系统日志页面
- 登录日志和下载日志标签页切换
- 日志搜索和筛选功能
- 日志表格展示
- 分页组件

### 7.5 统计报表页面
- 统计数据卡片展示
- 最新上传文件表格
- 文件类型分布展示
- 分享链接统计卡片
- 下载统计表格

## 8. 安全设计

### 8.1 认证安全
- 使用JWT进行无状态认证
- 令牌过期机制
- 刷新令牌机制
- HTTP传输（开发环境）

### 8.2 密码安全
- SHA256加密存储
- 密码复杂度要求
- 密码有效期管理
- 防暴力破解机制

### 8.3 令牌安全
- 令牌超时控制
- 多设备令牌管理
- 令牌撤销机制

### 8.4 日志安全
- 日志记录用户操作
- 敏感信息脱敏处理
- 日志访问权限控制

## 9. 性能优化

### 9.1 缓存策略
- 项目不使用任何缓存策略

### 9.2 数据库优化
- 项目不使用数据库索引优化

## 10. 错误处理

### 10.1 常见错误码
| 错误码 | 说明 | HTTP状态码 |
|--------|------|------------|
| 20001 | 未登录 | 401 |
| 20002 | 登录已过期 | 401 |
| 20003 | 用户名或密码错误 | 401 |
| 20004 | 账号已锁定 | 401 |
| 20005 | 权限不足 | 403 |

### 10.2 错误响应格式
```json
{
  "code": 20003,
  "message": "用户名或密码错误",
  "timestamp": "2024-01-01T12:00:00Z",
  "requestId": "uuid-request-id"
}
```

## 11. 测试策略

### 11.1 单元测试
- 用户认证逻辑测试
- 密码加密解密测试
- 令牌生成验证测试
- 会话管理测试
- 日志记录测试
- 统计数据计算测试

### 11.2 集成测试
- 登录流程测试
- 令牌刷新测试
- 权限验证测试
- 安全机制测试
- 日志记录测试
- 统计报表测试

### 11.3 UI测试
- 登录页面交互测试
- 表单验证测试
- 响应式适配测试
- 用户引导流程测试
- 系统日志页面测试
- 统计报表页面测试

## 12. 部署与监控

### 12.1 部署要求
- .NET 9.0 运行环境（单一项目结构）
- 数据库连接配置

### 12.2 监控指标
- 登录成功率
- 认证失败率
- 令牌刷新频率
- 账号锁定次数
- 日志记录数量
- 系统性能指标

## 13. 系统目录结构

### 13.1 后端项目结构 (.NET 9.0 单一项目)
```
SquadFile/
├── Program.cs                  # 程序入口点
├── appsettings.json           # 配置文件
├── Controllers/               # 控制器
│   ├── AuthController.cs     # 认证相关接口
│   ├── UserController.cs     # 用户管理接口
│   ├── SystemController.cs   # 系统设置接口
│   ├── LogController.cs      # 日志管理接口
│   └── BaseController.cs     # 基础控制器
├── Services/                 # 业务服务
│   ├── AuthService.cs        # 认证服务
│   ├── UserService.cs        # 用户服务
│   ├── SystemSettingsService.cs # 系统设置服务
│   ├── LogService.cs         # 日志服务
│   └── LocalizationService.cs # 本地化服务
├── Models/                   # 数据模型
│   ├── SysUser.cs            # 用户实体
│   ├── SystemSettings.cs     # 系统设置实体
│   ├── LoginLog.cs           # 登录日志实体
│   ├── DownloadLog.cs        # 下载日志实体
│   └── ViewModel/            # 数据传输对象
│       ├── LoginRequest.cs
│       ├── LoginResponse.cs
│       ├── CreateUserRequest.cs
│       └── UserDto.cs
├── Data/                     # 数据访问
│   ├── ApplicationDbContext.cs # 数据库上下文
│   └── Migrations/           # 数据库迁移文件
├── Security/                 # 安全相关
│   ├── JwtHelper.cs          # JWT令牌生成与验证
│   └── PasswordHasher.cs     # 密码加密处理
├── Properties/               # 项目属性
│   └── launchSettings.json
├── wwwroot/                  # 静态文件
└── SquadFile.csproj          # 项目文件
```

### 13.2 前端项目结构 (Uniapp + Vue3)
```
frontend/
├── package.json               # 包管理文件
├── vite.config.js            # Vite配置
├── manifest.json             # 应用配置
├── pages.json                # 页面配置
├── App.vue                   # 应用根组件
├── main.js                   # 应用入口
├── src/
│   ├── pages/                # 页面目录
│   │   ├── auth/            # 认证相关页面
│   │   │   └── login.vue    # 登录页面
│   │   ├── admin/           # 管理页面
│   │   │   ├── settings.vue # 系统设置页面
│   │   │   ├── system-logs.vue # 系统日志页面
│   │   │   ├── reports.vue  # 统计报表页面
│   │   │   └── ...          # 其他管理页面
│   │   └── ...              # 其他页面
│   ├── components/           # 组件目录
│   │   ├── auth/            # 认证相关组件
│   │   │   └── LoginForm.vue # 登录表单组件
│   │   └── ...              # 其他组件
│   ├── stores/               # 状态管理(Pinia)
│   │   └── auth.js          # 认证状态管理
│   ├── services/             # API服务
│   │   ├── auth.js          # 认证相关API
│   │   ├── system.js        # 系统相关API
│   │   └── request.js       # HTTP请求封装
│   ├── utils/                # 工具函数
│   │   └── crypto.js        # 加密工具
│   ├── locales/              # 国际化资源
│   │   ├── zh-Hans.json     # 中文资源
│   │   └── en-US.json       # 英文资源
│   └── styles/               # 样式文件
│       └── auth.css          # 认证相关样式
├── static/                   # 静态文件
└── dist/                     # 构建输出
```


## 14. 语言设置功能设计

### 14.1 功能概述
语言设置功能允许管理员配置系统的默认显示语言，并允许用户在登录页和首页通过下拉列表切换显示语言。系统支持中文和英文两种语言。

### 14.2 功能需求
- 管理员可在系统设置中配置默认显示语言
- 用户可在登录页和首页通过语言选择下拉列表切换显示语言
- 系统需记住用户选择的语言偏好
- 页面内容需根据选择的语言进行动态切换

### 14.3 技术实现

#### 14.3.1 后端实现
- 在系统设置表中添加语言配置字段
- 提供API接口用于获取和更新语言设置
- 在用户表中添加用户语言偏好字段

#### 14.3.2 前端实现
- 在登录页和首页添加语言选择下拉列表
- 使用国际化（i18n）库管理多语言资源
- 根据用户选择动态切换界面语言
- 将用户语言偏好保存到本地存储

### 14.4 数据库设计

#### 14.4.1 系统设置表扩展
```sql
ALTER TABLE SystemSettings ADD COLUMN DefaultLanguage VARCHAR(10) DEFAULT 'zh-Hans';
```

#### 14.4.2 用户表扩展
```sql
ALTER TABLE Users ADD COLUMN PreferredLanguage VARCHAR(10) DEFAULT NULL;
```

### 14.5 API接口设计

#### 14.5.1 获取系统语言设置
```http
GET /squadfile-api/system/language-settings
Authorization: Bearer {access_token}

响应：
{
  "code": 200,
  "message": "成功",
  "data": {
    "defaultLanguage": "zh-Hans",
    "supportedLanguages": [
      {"code": "zh-Hans", "name": "中文"},
      {"code": "en-US", "name": "English"}
    ]
  }
}
```

#### 14.5.2 更新系统默认语言设置
```http
PUT /squadfile-api/system/language-settings
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "defaultLanguage": "en-US"
}

响应：
{
  "code": 200,
  "message": "语言设置更新成功"
}
```

#### 14.5.3 更新用户语言偏好
```http
PUT /squadfile-api/system/users/{userId}/language
Authorization: Bearer {access_token}
Content-Type: application/json

{
  "preferredLanguage": "en-US"
}

响应：
{
  "code": 200,
  "message": "语言偏好更新成功"
}
```

## 15. 系统日志功能设计

### 15.1 功能概述
系统日志功能用于记录用户的关键操作，包括登录尝试和文件下载操作，便于管理员监控系统使用情况和排查问题。

### 15.2 功能需求
- 记录所有用户的登录尝试，包括成功和失败的登录
- 记录所有文件下载操作
- 提供日志查询接口，支持按条件筛选
- 提供日志分页接口
- 支持日志导出功能

### 15.3 技术实现

#### 15.3.1 后端实现
- 创建登录日志和下载日志实体类
- 在数据库中创建相应的日志表
- 在认证服务中添加登录日志记录逻辑
- 在文件分享服务中添加下载日志记录逻辑
- 创建日志服务用于处理日志查询
- 创建日志控制器提供日志相关API接口

#### 15.3.2 前端实现
- 创建系统日志页面
- 实现登录日志和下载日志标签页切换
- 实现日志搜索和筛选功能
- 实现日志表格展示
- 实现分页组件

### 15.4 数据库设计

#### 15.4.1 登录日志表
```sql
CREATE TABLE LoginLog (
    Id              INT PRIMARY KEY AUTO_INCREMENT,
    UserId          INT NOT NULL,
    Username        VARCHAR(50) NOT NULL,
    LoginTime       DATETIME DEFAULT CURRENT_TIMESTAMP,
    IpAddress       VARCHAR(45),
    UserAgent       VARCHAR(500),
    LoginResult     BOOLEAN NOT NULL,
    FailureReason   VARCHAR(255)
);
```

#### 15.4.2 下载日志表
```sql
CREATE TABLE DownloadLog (
    Id              INT PRIMARY KEY AUTO_INCREMENT,
    UserId          INT NOT NULL,
    Username        VARCHAR(50) NOT NULL,
    DownloadTime    DATETIME DEFAULT CURRENT_TIMESTAMP,
    FileId          INT NOT NULL,
    OriginalFileName VARCHAR(255) NOT NULL,
    FilePath        VARCHAR(500) NOT NULL,
    FileSize        BIGINT NOT NULL,
    IpAddress       VARCHAR(45),
    DeviceType      VARCHAR(100),
    UserAgent       VARCHAR(500)
);
```

### 15.5 API接口设计

#### 15.5.1 获取登录日志
```http
GET /squadfile-api/log/login?page=1&pageSize=20&searchQuery=admin
Authorization: Bearer {access_token}

响应：
{
  "code": 200,
  "message": "成功",
  "data": {
    "items": [...],
    "totalCount": 1,
    "page": 1,
    "pageSize": 20,
    "totalPages": 1
  }
}
```

#### 15.5.2 获取下载日志
```http
GET /squadfile-api/log/download?page=1&pageSize=20&searchQuery=example.pdf
Authorization: Bearer {access_token}

响应：
{
  "code": 200,
  "message": "成功",
  "data": {
    "items": [...],
    "totalCount": 1,
    "page": 1,
    "pageSize": 20,
    "totalPages": 1
  }
}
```

## 16. 统计报表功能设计

### 16.1 功能概述
统计报表功能用于展示系统的关键统计数据，帮助管理员了解系统使用情况。

### 16.2 功能需求
- 显示系统关键指标概览（总用户数、总文件数等）
- 显示最新上传的文件列表
- 显示文件类型分布情况
- 显示分享链接统计信息
- 显示文件下载统计信息

### 16.3 技术实现

#### 16.3.1 后端实现
- 在系统设置服务中添加统计报表数据获取逻辑
- 创建管理统计数据视图模型
- 创建统计报表控制器提供API接口

#### 16.3.2 前端实现
- 创建统计报表页面
- 实现统计数据卡片展示
- 实现最新上传文件表格
- 实现文件类型分布展示
- 实现分享链接统计卡片
- 实现下载统计表格

### 16.4 API接口设计

#### 16.4.1 获取管理统计数据
```http
GET /squadfile-api/system/admin-stats
Authorization: Bearer {access_token}

响应：
{
  "code": 200,
  "message": "成功",
  "data": {
    "totalUsers": 10,
    "totalFiles": 100,
    "totalFolders": 20,
    "storageUsed": 104857600,
    "storageUsedDisplay": "100 MB",
    "totalDownloads": 50,
    "latestFiles": [...],
    "fileTypeDistribution": [...],
    "totalShareLinks": 15,
    "activeShareLinks": 10,
    "downloadStats": [...]
  }
}
```